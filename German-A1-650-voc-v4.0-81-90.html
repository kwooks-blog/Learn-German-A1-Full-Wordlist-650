<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>ë…ì¼ì–´ ë‹¨ì–´ í€´ì¦ˆ - ì „ì²´ ì„¸íŠ¸</title>
  <style>
    body { background-color: #FFF8DC; text-align: center; padding: 30px; }
    .quiz-box { background: #FFFAF0; border: 3px dashed #FFA07A; border-radius: 25px; padding: 20px; width: 80%; margin: 0 auto; display: none; }
    .question { font-size: 24px; margin-bottom: 20px; }
    .option-btn, .submit-btn, .nav-btn { background-color: #FFDAB9; border: 2px solid #F4A460; padding: 10px 20px; border-radius: 15px; cursor: pointer; font-size: 18px; margin: 10px; }
    .option-btn:hover, .submit-btn:hover, .nav-btn:hover { background-color: #F5DEB3; }
    .feedback { font-weight: bold; margin-top: 15px; }
    input[type="text"] { font-size: 20px; padding: 8px; border-radius: 10px; border: 2px solid #F4A460; text-align: center; margin-top: 10px; }
    .audio-btn { margin-top: 10px; cursor: pointer; }
  </style>
</head>
<body>
  <div id="intro" class="quiz-box" style="display:block">
    <h1>ğŸ¥ ë…ì¼ì–´ ë‹¨ì–´ í€´ì¦ˆ ğŸ¥</h1>
    <p>ì¬ë¯¸ìˆëŠ” ë‹¨ì–´ í€´ì¦ˆì— ë„ì „í•´ ë³´ì„¸ìš”!</p>
    <button class="nav-btn" onclick="startSet(1)">ì„¸íŠ¸ 1 ì‹œì‘ (ê°ê´€ì‹)</button>
  </div>

  <div id="quiz" class="quiz-box">
    <div class="question" id="question"></div>
    <button class="audio-btn" onclick="playAudio()">ğŸ”Š ë°œìŒ ë“£ê¸°</button>
    <div id="options"></div>
    <input type="text" id="answer" style="display:none" />
    <button class="submit-btn" onclick="checkAnswer()">ì œì¶œ</button>
    <div class="feedback" id="feedback"></div>
  </div>

  <script>
    const words = [
      { word: "heiraten", meaning: "get married (ê²°í˜¼í•˜ë‹¤)" },
      { word: "heiÃŸen", meaning: "be named / be called (ë¶ˆë¦¬ë‹¤)" },
      { word: "helfen", meaning: "help / assist (ë•ë‹¤)" },
      { word: "holen", meaning: "pick up / get (ê°€ì ¸ì˜¤ë‹¤)" },
      { word: "hÃ¶ren", meaning: "listen / hear (ë“£ë‹¤)" },
      { word: "kaufen", meaning: "buy (ì‚¬ë‹¤)" },
      { word: "kennen", meaning: "know (ì•Œë‹¤)" },
      { word: "kennenlernen", meaning: "meet / get to know (ë§Œë‚˜ë‹¤/ì•Œê²Œ ë˜ë‹¤)" },
      { word: "kochen", meaning: "cook (ìš”ë¦¬í•˜ë‹¤)" },
      { word: "kommen", meaning: "come (ì˜¤ë‹¤)" }
    ];

    let current = 0;
    let score = 0;
    let set = 1;

    function startSet(setNumber) {
      set = setNumber;
      current = 0;
      score = 0;
      document.getElementById('intro').style.display = 'none';
      document.getElementById('quiz').style.display = 'block';
      showQuestion();
    }

    function showQuestion() {
      const q = words[current];
      document.getElementById('question').textContent = `Q${current + 1}. ${set === 1 ? q.word : q.meaning}`;
      document.getElementById('feedback').textContent = '';
      document.getElementById('answer').style.display = 'none';
      document.getElementById('answer').value = '';
      document.getElementById('options').innerHTML = '';

      if (set === 1) {
        const shuffled = shuffleArray([q.meaning, ...getRandomMeanings(q.meaning)]);
        shuffled.forEach(opt => {
          const btn = document.createElement('button');
          btn.textContent = opt;
          btn.className = 'option-btn';
          btn.onclick = () => checkAnswer(opt);
          document.getElementById('options').appendChild(btn);
        });
      } else {
        document.getElementById('answer').style.display = 'inline-block';
        document.getElementById('answer').value =
          set === 2 ? maskWord(q.word, 0.2) :
          set === 3 ? maskWord(q.word, 0.5) :
          "";
      }
      playAudio();
    }

    function checkAnswer(selected = null) {
      const correct = set === 1 ? words[current].meaning : words[current].word.toLowerCase();
      const userAnswer = set === 1 ? selected : document.getElementById('answer').value.trim().toLowerCase();
      const feedback = document.getElementById('feedback');

      if (userAnswer === correct) {
        feedback.textContent = 'âœ… ì •ë‹µì´ì—ìš”!';
        feedback.style.color = 'green';
        score += 10;
      } else {
        feedback.textContent = `âŒ ì˜¤ë‹µì´ì—ìš”! ì •ë‹µ: ${correct}`;
        feedback.style.color = 'red';
      }
      setTimeout(() => {
        current++;
        if (current < words.length) {
          showQuestion();
        } else {
          if (set < 4) {
            document.getElementById('quiz').style.display = 'none';
            document.getElementById('intro').style.display = 'block';
            document.getElementById('intro').innerHTML = `<h2>ì„¸íŠ¸ ${set} ì™„ë£Œ! ì ìˆ˜: ${score}ì </h2><button class="nav-btn" onclick="startSet(${set + 1})">ì„¸íŠ¸ ${set + 1} ì‹œì‘</button>`;
          } else {
            document.getElementById('quiz').innerHTML = `<h2>ğŸ‰ ëª¨ë“  ì„¸íŠ¸ ì™„ë£Œ! ì´ì : ${score}ì </h2>`;
          }
        }
      }, 2000);
    }

    function playAudio() {
      const text = set === 1 ? words[current].word : words[current].word;
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'de-DE';
      speechSynthesis.speak(utter);
    }

    function maskWord(word, percent) {
      const length = word.length;
      const maskCount = Math.floor(length * percent);
      let masked = word.split('');
      let maskedIndices = [];
      while (maskedIndices.length < maskCount) {
        let i = Math.floor(Math.random() * length);
        if (!maskedIndices.includes(i)) maskedIndices.push(i);
      }
      maskedIndices.forEach(i => masked[i] = '_');
      return masked.join('');
    }

    function getRandomMeanings(correctMeaning) {
      const allMeanings = words.map(w => w.meaning).filter(m => m !== correctMeaning);
      return shuffleArray(allMeanings).slice(0, 3);
    }

    function shuffleArray(array) {
      return array.sort(() => Math.random() - 0.5);
    }
  </script>
</body>
</html>
